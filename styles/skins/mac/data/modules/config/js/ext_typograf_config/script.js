var stopped = false;$(document).ready(function () {    $('#typograf-config-form').submit(function () {        $(this).find('select[multiple]').each(function () {            var id = $(this).attr('id');            var value = $(this).val();            if ($('input[name="' + id + '"]').length > 0) {                $('input[name="' + id + '"]').val(value);            }        });    });    $('#typograf-mass-convert').click(function () {        stopped = false;        var limit = 10;        var offset = 0        typograf_massConvert(limit, offset);        return false;    });    $('body').on('click', '#typograf-mass-convert-cancel', function () {        stopped = true;    });    $('body').on('click', '.popupClose', function () {        stopped = true;    });    $(document).keyup(function (e) {        if (e.keyCode === 27) {            stopped = true;        }    });});typograf_massConvert = function (limit, offset) {    $.ajax({        url: '/udata/content/typograf_isEnabled/.json',        dataType: 'json',        async: false,        success: function (response) {            if (response.result === '0') {                openDialog({                    title: 'Обновить типографику на сайте',                    text: 'Для обновления типографики необходимо активировать расширение. Активируйте галочку <strong>«Включить Типограф»</strong>, после чего нажмите кнопку <strong>«Сохранить»</strong>.<br/><br/>',                    width: 390,                    stdButtons: true                });            } else {                if (!stopped) {                    if (parseInt(offset) === 0 || isNaN(offset)) {                        var h = '<div class="exchange_container">';                        h += '<div id="process-header">Обновление типографики</div>';                        h += '<div><img id="process-bar" src="/images/cms/admin/mac/process.gif" class="progress" /></div>';                        h += '</div>';                        h += '<div id="prepare_log"></div>';                        h += '<div id="export_log"></div>';                        h += '<div class="eip_buttons">';                        h += '<input id="typograf-mass-convert-cancel" type="button" value="Остановить" class="stop" />';                        h += '<div style="clear: both;"/>';                        h += '</div>';                        openDialog({                            stdButtons: false,                            title: 'Обновить типографику на сайте',                            text: h,                            width: 390                        });                    }                    var move_forward = false;                    $.ajax({                        url: '/udata/content/typograf_massConvert/' + limit + '/' + offset + '/.json',                        dataType: 'json',                        success: function (data) {                            offset += limit;                            if (parseInt(data.processed) < parseInt(data.total)) {                                move_forward = true;                            }                        },                        complete: function () {                            if (move_forward) {                                typograf_massConvert(limit, offset)                            } else {                                typograf_closeDialog();                                typograf_successDialog();                            }                        }                    });                } else {                    typograf_closeDialog();                }            }    }});};typograf_closeDialog = function () {    $('.popupClose').click();};typograf_successDialog = function () {    openDialog({        title: 'Обновить типографику на сайте',        text: 'Типографика обновлена.<br/><br/>',        width: 390,        stdButtons: true    });};